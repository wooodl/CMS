<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼èˆªæ æ‚¬åœåŠŸèƒ½å¢å¼ºæµ‹è¯•é¡µé¢</title>
    <link rel="stylesheet" href="wwwroot/lib/layui/css/layui.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        
        /* è°ƒè¯•ä¿¡æ¯é¢æ¿ */
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 350px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 15px;
            z-index: 100000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 12px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .debug-panel h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
        }
        
        .debug-info {
            margin: 5px 0;
            color: #666;
            font-size: 11px;
        }
        
        .debug-buttons {
            margin: 10px 0;
        }
        
        .debug-buttons button {
            margin: 2px;
            padding: 5px 8px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
        }
        
        .btn-red { background: #FF4444; color: white; }
        .btn-blue { background: #4444FF; color: white; }
        .btn-green { background: #44AA44; color: white; }
        .btn-orange { background: #FF8844; color: white; }
        .btn-purple { background: #8844FF; color: white; }
        .btn-teal { background: #44AAAA; color: white; }
        
        /* æ”¶ç¼©çŠ¶æ€ä¸‹å¼ºåˆ¶è¦†ç›–layuiçš„éšè—æ ·å¼ */
        body .layui-layout-admin.layui-layout-shrink .layui-nav-tree .layui-nav-child,
        body .layui-layout-admin.layui-layout-shrink .layui-nav-tree .layui-nav-item .layui-nav-child,
        body .layui-layout-admin.layui-layout-shrink .layui-nav-tree .layui-nav-item.layui-nav-itemed .layui-nav-child {
            display: block !important;
            position: absolute !important;
            left: 60px !important;
            top: 0 !important;
            z-index: 99999 !important;
            background-color: #2F4056 !important;
            border-radius: 2px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
            min-width: 160px !important;
            border: 1px solid #393D49 !important;
            opacity: 0 !important;
            visibility: hidden !important;
            transform: translateX(-10px) !important;
            transition: all 0.2s ease !important;
            pointer-events: none !important;
        }
        
        /* ç¡®ä¿é“¾æ¥å…ƒç´ æœ‰ç›¸å¯¹å®šä½ */
        body .layui-layout-admin.layui-layout-shrink .layui-nav-tree .layui-nav-item > a {
            position: relative !important;
        }
        
        /* æ˜¾ç¤ºå­èœå•çš„ç±» */
        body .layui-layout-admin.layui-layout-shrink .layui-nav-tree .layui-nav-child.show-submenu,
        body .layui-layout-admin.layui-layout-shrink .layui-nav-tree .layui-nav-item .layui-nav-child.show-submenu,
        body .layui-layout-admin.layui-layout-shrink .layui-nav-tree .layui-nav-item.layui-nav-itemed .layui-nav-child.show-submenu {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            transform: translateX(0) !important;
            pointer-events: auto !important;
        }
        
        /* è°ƒè¯•æ ·å¼ */
        .debug-highlight {
            background-color: #FF0000 !important;
            color: #FFFFFF !important;
            border: 2px solid #00FF00 !important;
        }
        
        /* ä½ç½®æŒ‡ç¤ºå™¨ */
        .position-indicator {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #FF0000;
            border-radius: 50%;
            z-index: 100000;
        }
    </style>
</head>
<body>
    <!-- è°ƒè¯•é¢æ¿ -->
    <div class="debug-panel">
        <h4>ğŸ”§ å¯¼èˆªæ æ‚¬åœæµ‹è¯•å·¥å…· - å¢å¼ºç‰ˆ</h4>
        
        <div class="debug-info">
            <div id="shrink-status">æ”¶ç¼©çŠ¶æ€: æœªçŸ¥</div>
            <div id="hover-status">æ‚¬åœçŠ¶æ€: æ— </div>
            <div id="submenu-count">å­èœå•æ•°é‡: 0</div>
            <div id="position-info">ä½ç½®ä¿¡æ¯: æ— </div>
            <div id="offset-info">å½“å‰åç§»: -42px</div>
        </div>
        
        <div class="debug-buttons">
            <button class="btn-blue" onclick="toggleShrink()">åˆ‡æ¢æ”¶ç¼©</button>
            <button class="btn-red" onclick="forceShowSubmenu()">æ˜¾ç¤ºå­èœå•</button>
            <button class="btn-green" onclick="hideAllSubmenu()">éšè—å­èœå•</button>
            <button class="btn-orange" onclick="showPositionIndicators()">ä½ç½®æŒ‡ç¤ºå™¨</button>
            <button class="btn-purple" onclick="testOffsets()">æµ‹è¯•åç§»é‡</button>
            <button class="btn-teal" onclick="debugAllPositions()">è°ƒè¯•ä½ç½®</button>
        </div>
        
        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
            <strong>åç§»é‡æµ‹è¯•ï¼š</strong><br>
            <button onclick="setOffset(0)" style="margin: 1px; padding: 2px 5px; font-size: 10px;">0px</button>
            <button onclick="setOffset(-21)" style="margin: 1px; padding: 2px 5px; font-size: 10px;">-21px</button>
            <button onclick="setOffset(-42)" style="margin: 1px; padding: 2px 5px; font-size: 10px;">-42px</button>
            <button onclick="setOffset(-63)" style="margin: 1px; padding: 2px 5px; font-size: 10px;">-63px</button>
            <button onclick="setOffset(-84)" style="margin: 1px; padding: 2px 5px; font-size: 10px;">-84px</button>
        </div>
        
        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
            <strong>æµ‹è¯•æ­¥éª¤ï¼š</strong><br>
            1. ç‚¹å‡»"åˆ‡æ¢æ”¶ç¼©"<br>
            2. ç‚¹å‡»"æµ‹è¯•åç§»é‡"<br>
            3. è§‚å¯Ÿå“ªä¸ªåç§»é‡æ­£ç¡®<br>
            4. ä½¿ç”¨å¯¹åº”çš„åç§»é‡æŒ‰é’®<br>
            5. æµ‹è¯•é¼ æ ‡æ‚¬åœåŠŸèƒ½
        </div>
    </div>

    <!-- ä¸»å¸ƒå±€ -->
    <div class="layui-layout layui-layout-admin" id="layout">
        <!-- å¤´éƒ¨ -->
        <div class="layui-header">
            <div class="layui-logo layui-hide-xs layui-bg-black">ç»¼åˆç®¡ç†ç³»ç»Ÿ</div>
            <ul class="layui-nav layui-layout-left">
                <li class="layui-nav-item">
                    <a href="javascript:;" class="layui-icon layui-icon-spread-left" id="shrink-btn"></a>
                </li>
            </ul>
        </div>
        
        <!-- å·¦ä¾§å¯¼èˆª -->
        <div class="layui-side layui-bg-black">
            <div class="layui-side-scroll">
                <ul class="layui-nav layui-nav-tree" lay-filter="test">
                    <li class="layui-nav-item">
                        <a href="javascript:;">
                            <i class="layui-icon layui-icon-home"></i>
                            <span>é¦–é¡µ</span>
                        </a>
                    </li>
                    
                    <li class="layui-nav-item">
                        <a href="javascript:;">
                            <i class="layui-icon layui-icon-user"></i>
                            <span>äººå‘˜ç®¡ç†</span>
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a href="javascript:;">äººå‘˜ä¿¡æ¯</a></dd>
                            <dd><a href="javascript:;">ç®€åŒ–äººå‘˜</a></dd>
                            <dd><a href="javascript:;">éƒ¨é—¨ç®¡ç†</a></dd>
                        </dl>
                    </li>
                    
                    <li class="layui-nav-item">
                        <a href="javascript:;">
                            <i class="layui-icon layui-icon-util"></i>
                            <span>é£æœºç®¡ç†</span>
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a href="javascript:;">é£æœºä¿¡æ¯</a></dd>
                            <dd><a href="javascript:;">ç»´æŠ¤è®°å½•</a></dd>
                            <dd><a href="javascript:;">é£è¡Œè®¡åˆ’</a></dd>
                        </dl>
                    </li>
                    
                    <li class="layui-nav-item">
                        <a href="javascript:;">
                            <i class="layui-icon layui-icon-component"></i>
                            <span>è£…å¤‡ç®¡ç†</span>
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a href="javascript:;">è£…å¤‡ä¿¡æ¯</a></dd>
                            <dd><a href="javascript:;">ç»´æŠ¤è®°å½•</a></dd>
                            <dd><a href="javascript:;">åº“å­˜ç®¡ç†</a></dd>
                        </dl>
                    </li>
                    
                    <li class="layui-nav-item">
                        <a href="javascript:;">
                            <i class="layui-icon layui-icon-engine"></i>
                            <span>è®¾å¤‡ç®¡ç†</span>
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a href="javascript:;">è®¾å¤‡ä¿¡æ¯</a></dd>
                            <dd><a href="javascript:;">ç»´æŠ¤è®°å½•</a></dd>
                        </dl>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- å†…å®¹ä¸»ä½“ -->
        <div class="layui-body">
            <div style="padding: 20px; background-color: #f5f5f5; min-height: 100vh;">
                <div style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h2>å¯¼èˆªæ æ‚¬åœåŠŸèƒ½å¢å¼ºæµ‹è¯•</h2>
                    <p>è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæµ‹è¯•å’Œè°ƒè¯•å·¦ä¾§å¯¼èˆªæ æ”¶ç¼©çŠ¶æ€ä¸‹é¼ æ ‡æ‚¬åœæ˜¾ç¤ºå­èœå•åŠŸèƒ½çš„é¡µé¢ã€‚</p>
                    
                    <h3>æ–°å¢åŠŸèƒ½ï¼š</h3>
                    <ul>
                        <li><strong>åç§»é‡æµ‹è¯•</strong>ï¼šå¯ä»¥æµ‹è¯•ä¸åŒçš„åç§»é‡ï¼Œæ‰¾åˆ°æœ€ä½³ä½ç½®</li>
                        <li><strong>ä½ç½®è°ƒè¯•</strong>ï¼šè¯¦ç»†è¾“å‡ºæ‰€æœ‰èœå•é¡¹çš„ä½ç½®ä¿¡æ¯</li>
                        <li><strong>å®æ—¶è°ƒæ•´</strong>ï¼šå¯ä»¥å®æ—¶è°ƒæ•´åç§»é‡å¹¶æŸ¥çœ‹æ•ˆæœ</li>
                        <li><strong>å¤šç§æµ‹è¯•æ¨¡å¼</strong>ï¼šæ”¯æŒå¤šç§æµ‹è¯•å’Œè°ƒè¯•æ–¹å¼</li>
                    </ul>
                    
                    <h3>ä½¿ç”¨æ–¹æ³•ï¼š</h3>
                    <ol>
                        <li>ç‚¹å‡»å³ä¸Šè§’è°ƒè¯•é¢æ¿ä¸­çš„"åˆ‡æ¢æ”¶ç¼©"æŒ‰é’®</li>
                        <li>ç‚¹å‡»"æµ‹è¯•åç§»é‡"æŒ‰é’®ï¼Œè§‚å¯Ÿæ‰€æœ‰å­èœå•çš„æ˜¾ç¤ºæ•ˆæœ</li>
                        <li>æ‰¾åˆ°ä½ç½®æ­£ç¡®çš„å­èœå•ï¼Œè®°ä½å¯¹åº”çš„åç§»é‡</li>
                        <li>ç‚¹å‡»å¯¹åº”çš„åç§»é‡æŒ‰é’®ï¼ˆå¦‚-42pxï¼‰</li>
                        <li>æµ‹è¯•é¼ æ ‡æ‚¬åœåŠŸèƒ½æ˜¯å¦æ­£å¸¸</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script src="wwwroot/lib/jquery/dist/jquery.min.js"></script>
    <script src="wwwroot/lib/layui/layui.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        var currentOffset = -42; // é»˜è®¤åç§»é‡
        
        // è°ƒè¯•å‡½æ•°
        function updateDebugInfo() {
            var $layout = $('#layout');
            var isShrink = $layout.hasClass('layui-layout-shrink');
            var submenuCount = $('.layui-nav-child').length;
            
            $('#shrink-status').text('æ”¶ç¼©çŠ¶æ€: ' + (isShrink ? 'æ˜¯' : 'å¦'));
            $('#submenu-count').text('å­èœå•æ•°é‡: ' + submenuCount);
            $('#offset-info').text('å½“å‰åç§»: ' + currentOffset + 'px');
        }
        
        function toggleShrink() {
            var $layout = $('#layout');
            $layout.toggleClass('layui-layout-shrink');
            updateDebugInfo();
            enhanceShrinkHover();
            console.log('åˆ‡æ¢æ”¶ç¼©çŠ¶æ€');
        }
        
        function setOffset(offset) {
            currentOffset = offset;
            updateDebugInfo();
            console.log('è®¾ç½®åç§»é‡ä¸º:', offset + 'px');
            
            // å¦‚æœå½“å‰æœ‰æ˜¾ç¤ºçš„å­èœå•ï¼Œé‡æ–°åº”ç”¨åç§»
            $('.layui-nav-child.show-submenu').each(function() {
                var $child = $(this);
                var $item = $child.closest('.layui-nav-item');
                var $link = $item.find('> a');
                var linkOffset = $link.offset();
                var sidebarWidth = $('.layui-side').outerWidth();
                
                $child.css({
                    'position': 'fixed',
                    'left': sidebarWidth + 'px',
                    'top': (linkOffset.top + offset) + 'px'
                });
            });
        }
        
        function forceShowSubmenu() {
            console.log('å¼ºåˆ¶æ˜¾ç¤ºæ‰€æœ‰å­èœå•ï¼Œä½¿ç”¨åç§»é‡:', currentOffset + 'px');
            $('.layui-nav-child').each(function(index) {
                var $child = $(this);
                var $item = $child.closest('.layui-nav-item');
                var $link = $item.find('> a');
                var linkOffset = $link.offset();
                var sidebarWidth = $('.layui-side').outerWidth();
                
                $child.addClass('show-submenu');
                $child.css({
                    'display': 'block',
                    'position': 'fixed',
                    'top': (linkOffset.top + currentOffset) + 'px',
                    'left': sidebarWidth + 'px',
                    'background-color': '#FF0000',
                    'color': '#FFFFFF',
                    'z-index': '999999',
                    'min-width': '160px',
                    'border': '3px solid #00FF00'
                });
                
                console.log('å­èœå• ' + index + ':', {
                    menuText: $item.find('span').text(),
                    linkOffset: linkOffset,
                    appliedOffset: currentOffset,
                    finalTop: (linkOffset.top + currentOffset),
                    finalLeft: sidebarWidth
                });
            });
            
            $('#position-info').text('ä½ç½®ä¿¡æ¯: å·²æ˜¾ç¤ºï¼Œåç§» ' + currentOffset + 'px');
        }
        
        function testOffsets() {
            console.log('=== æµ‹è¯•æ‰€æœ‰åç§»é‡ ===');
            var offsets = [0, -21, -42, -63, -84];
            
            $('.layui-nav-child').each(function(index) {
                var $child = $(this);
                var $item = $child.closest('.layui-nav-item');
                var $link = $item.find('> a');
                var linkOffset = $link.offset();
                var sidebarWidth = $('.layui-side').outerWidth();
                
                var testOffset = offsets[index % offsets.length];
                
                $child.addClass('show-submenu');
                $child.css({
                    'display': 'block',
                    'position': 'fixed',
                    'top': (linkOffset.top + testOffset) + 'px',
                    'left': sidebarWidth + 'px',
                    'background-color': '#FF' + (index * 40).toString(16).padStart(2, '0') + '00',
                    'color': '#FFFFFF',
                    'z-index': '999999',
                    'min-width': '160px',
                    'border': '2px solid #000'
                });
                
                // æ·»åŠ åç§»é‡æ ‡ç­¾
                $child.prepend('<div style="background: #000; color: #fff; padding: 2px 5px; font-size: 10px;">åç§»: ' + testOffset + 'px</div>');
                
                console.log('å­èœå• ' + index + ' (åç§» ' + testOffset + 'px):', {
                    menuText: $item.find('span').text(),
                    originalTop: linkOffset.top,
                    adjustedTop: linkOffset.top + testOffset
                });
            });
            
            $('#position-info').text('ä½ç½®ä¿¡æ¯: æµ‹è¯•å¤šç§åç§»é‡');
        }
        
        function debugAllPositions() {
            console.log('=== æ‰€æœ‰èœå•é¡¹ä½ç½®è°ƒè¯• ===');
            $('.layui-nav-item').each(function(index) {
                var $item = $(this);
                var $link = $item.find('> a');
                var $span = $item.find('span');
                var hasSubmenu = $item.find('.layui-nav-child').length > 0;
                
                if ($span.length > 0) {
                    console.log('èœå•é¡¹ ' + index + ':', {
                        text: $span.text(),
                        hasSubmenu: hasSubmenu,
                        itemOffset: $item.offset(),
                        linkOffset: $link.offset(),
                        itemHeight: $item.outerHeight(),
                        linkHeight: $link.outerHeight()
                    });
                }
            });
            
            $('#position-info').text('ä½ç½®ä¿¡æ¯: å·²è¾“å‡ºåˆ°æ§åˆ¶å°');
        }
        
        function hideAllSubmenu() {
            $('.layui-nav-child').removeClass('show-submenu debug-highlight');
            $('.position-indicator').remove();
            $('.layui-nav-child div').remove(); // ç§»é™¤åç§»é‡æ ‡ç­¾
            $('#hover-status').text('æ‚¬åœçŠ¶æ€: æ— ');
            $('#position-info').text('ä½ç½®ä¿¡æ¯: æ— ');
            console.log('éšè—æ‰€æœ‰å­èœå•');
        }
        
        function showPositionIndicators() {
            $('.position-indicator').remove();
            
            $('.layui-nav-item').each(function(index) {
                var $item = $(this);
                var $link = $item.find('> a');
                var offset = $link.offset();
                
                if (offset) {
                    var $indicator = $('<div class="position-indicator"></div>');
                    $indicator.css({
                        'left': offset.left + 'px',
                        'top': offset.top + 'px'
                    });
                    $('body').append($indicator);
                    
                    console.log('èœå•é¡¹ ' + index + ' ä½ç½®:', offset);
                }
            });
            
            $('#position-info').text('ä½ç½®ä¿¡æ¯: çº¢ç‚¹æ˜¾ç¤ºèœå•é¡¹ä½ç½®');
        }
        
        // å¢å¼ºæ”¶ç¼©çŠ¶æ€ä¸‹çš„æ‚¬åœåŠŸèƒ½
        function enhanceShrinkHover() {
            $('.layui-nav-tree .layui-nav-item').off('.shrink-hover');

            $('.layui-nav-tree .layui-nav-item').each(function() {
                var $item = $(this);
                var $child = $item.find('.layui-nav-child');

                if ($child.length > 0) {
                    $item.on('mouseenter.shrink-hover', function() {
                        $('#hover-status').text('æ‚¬åœçŠ¶æ€: è¿›å…¥ ' + $(this).find('span').text());
                        
                        if ($('.layui-layout-admin').hasClass('layui-layout-shrink')) {
                            clearTimeout($item.data('hideTimer'));
                            clearTimeout($item.data('showTimer'));
                            
                            var $link = $item.find('> a');
                            var linkOffset = $link.offset();
                            var sidebarWidth = $('.layui-side').outerWidth();
                            
                            $child.css({
                                'position': 'fixed',
                                'left': sidebarWidth + 'px',
                                'top': (linkOffset.top + currentOffset) + 'px',
                                'z-index': '99999'
                            });
                            
                            var showTimer = setTimeout(function() {
                                $child.addClass('show-submenu');
                            }, 100);
                            $item.data('showTimer', showTimer);
                        }
                    });

                    $item.on('mouseleave.shrink-hover', function() {
                        $('#hover-status').text('æ‚¬åœçŠ¶æ€: ç¦»å¼€ ' + $(this).find('span').text());
                        
                        if ($('.layui-layout-admin').hasClass('layui-layout-shrink')) {
                            clearTimeout($item.data('showTimer'));
                            
                            var hideTimer = setTimeout(function() {
                                $child.removeClass('show-submenu');
                                $('#hover-status').text('æ‚¬åœçŠ¶æ€: æ— ');
                            }, 300);
                            $item.data('hideTimer', hideTimer);
                        }
                    });

                    $child.on('mouseenter.shrink-hover', function() {
                        if ($('.layui-layout-admin').hasClass('layui-layout-shrink')) {
                            clearTimeout($item.data('hideTimer'));
                            clearTimeout($item.data('showTimer'));
                            $(this).addClass('show-submenu');
                        }
                    });

                    $child.on('mouseleave.shrink-hover', function() {
                        if ($('.layui-layout-admin').hasClass('layui-layout-shrink')) {
                            var hideTimer = setTimeout(function() {
                                $child.removeClass('show-submenu');
                                $('#hover-status').text('æ‚¬åœçŠ¶æ€: æ— ');
                            }, 300);
                            $item.data('hideTimer', hideTimer);
                        }
                    });
                }
            });
        }

        // åˆå§‹åŒ–
        layui.use('element', function(){
            var element = layui.element;
            
            $(document).ready(function() {
                updateDebugInfo();
                enhanceShrinkHover();
                
                // ç»‘å®šæ”¶ç¼©æŒ‰é’®
                $('#shrink-btn').click(function() {
                    toggleShrink();
                });
                
                console.log('å¢å¼ºæµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
            });
        });
    </script>
</body>
</html>
