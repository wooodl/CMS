@model ComprehensiveManagementSystem.Models.PersonnelBasicInfo

@{
    ViewData["Title"] = "人员详情";
}

<div class="layui-row">
    <div class="layui-col-md12">
        <div class="layui-card">
            <div class="layui-card-header">
                <h3>人员详情 - @Model.Name</h3>
            </div>
            <div class="layui-card-body">
                
                <!-- 操作按钮 -->
                <div style="margin-bottom: 20px;">
                    <a href="@Url.Action("Edit", new { id = Model.PersonnelId })" class="layui-btn layui-btn-normal">
                        <i class="layui-icon layui-icon-edit"></i> 编辑信息
                    </a>
                    <a href="@Url.Action("Index")" class="layui-btn layui-btn-primary">
                        <i class="layui-icon layui-icon-return"></i> 返回列表
                    </a>
                </div>

                <!-- Tab 选项卡 -->
                <div class="layui-tab layui-tab-brief" lay-filter="personnelTab">
                    <ul class="layui-tab-title">
                        <li class="layui-this" lay-id="0">基本信息</li>
                        <li lay-id="1">补充信息</li>
                        <li lay-id="2">奖惩记录</li>
                        <li lay-id="3">工作履历</li>
                        <li lay-id="4">培训情况</li>
                        <li lay-id="5">配偶信息</li>
                        <li lay-id="6">家庭成员</li>
                        <li lay-id="7">工作记录</li>
                        <li lay-id="8">活动记录</li>
                    </ul>
                    <div class="layui-tab-content">
                        
                        <!-- 基本信息 -->
                        <div class="layui-tab-item layui-show">
                            <div class="layui-row layui-col-space20">
                                <div class="layui-col-md6">
                                    <table class="layui-table">
                                        <tbody>
                                            <tr>
                                                <td width="100"><strong>姓名</strong></td>
                                                <td>@Model.Name</td>
                                            </tr>
                                            <tr>
                                                <td><strong>性别</strong></td>
                                                <td>@(Model.Gender == ComprehensiveManagementSystem.Models.Gender.Male ? "男" : "女")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>身份证号</strong></td>
                                                <td>@Model.IdCard</td>
                                            </tr>
                                            <tr>
                                                <td><strong>出生年月</strong></td>
                                                <td>@Model.BirthDate.ToString("yyyy-MM-dd")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>籍贯</strong></td>
                                                <td>@(Model.NativePlace ?? "-")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>学历</strong></td>
                                                <td>@(Model.Education ?? "-")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>民族</strong></td>
                                                <td>@(Model.Nation ?? "-")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>政治面貌</strong></td>
                                                <td>@(Model.PoliticalStatus ?? "-")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>婚姻状况</strong></td>
                                                <td>
                                                    @switch(Model.MaritalStatus)
                                                    {
                                                        case ComprehensiveManagementSystem.Models.MaritalStatus.Single:
                                                            <text>未婚</text>
                                                            break;
                                                        case ComprehensiveManagementSystem.Models.MaritalStatus.Married:
                                                            <text>已婚</text>
                                                            break;
                                                        case ComprehensiveManagementSystem.Models.MaritalStatus.Divorced:
                                                            <text>离异</text>
                                                            break;
                                                        case ComprehensiveManagementSystem.Models.MaritalStatus.Widowed:
                                                            <text>丧偶</text>
                                                            break;
                                                    }
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="layui-col-md6">
                                    <table class="layui-table">
                                        <tbody>
                                            <tr>
                                                <td width="100"><strong>入职时间</strong></td>
                                                <td>@Model.HireDate.ToString("yyyy-MM-dd")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>部门</strong></td>
                                                <td>@(Model.Department?.Name ?? "-")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>岗位</strong></td>
                                                <td>@(Model.Position ?? "-")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>职务</strong></td>
                                                <td>@(Model.Duty ?? "-")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>人员类别</strong></td>
                                                <td>@(Model.PersonnelCategory ?? "-")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>级别</strong></td>
                                                <td>@(Model.Grade ?? "-")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>职务等级</strong></td>
                                                <td>@(Model.DutyLevel ?? "-")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>工作证号</strong></td>
                                                <td>@(Model.WorkId ?? "-")</td>
                                            </tr>
                                            <tr>
                                                <td><strong>联系电话</strong></td>
                                                <td>@(Model.Phone ?? "-")</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- 补充信息 -->
                        <div class="layui-tab-item">
                            @if (Model.SupplementaryInfo != null && !Model.SupplementaryInfo.IsDeleted)
                            {
                                <div style="margin-bottom: 15px;">
                                    <a href="@Url.Action("EditSupplementaryInfoByPersonnelId", new { id = Model.PersonnelId })" class="layui-btn layui-btn-normal">
                                        <i class="layui-icon layui-icon-edit"></i> 编辑补充信息
                                    </a>
                                </div>
                                
                                <div class="layui-row layui-col-space20">
                                    <div class="layui-col-md6">
                                        <table class="layui-table">
                                            <tbody>
                                                <tr>
                                                    <td width="130"><strong>入党(团)时间</strong></td>
                                                    <td>@(Model.SupplementaryInfo.PartyJoinDate?.ToString("yyyy-MM") ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>最近级别调整时间</strong></td>
                                                    <td>@(Model.SupplementaryInfo.LastGradeAdjustmentDate?.ToString("yyyy-MM") ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>待遇级别</strong></td>
                                                    <td>@(Model.SupplementaryInfo.TreatmentLevel ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>最近待遇调整时间</strong></td>
                                                    <td>@(Model.SupplementaryInfo.LastTreatmentAdjustmentDate?.ToString("yyyy-MM") ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>加入部门时间</strong></td>
                                                    <td>@(Model.SupplementaryInfo.DepartmentJoinDate?.ToString("yyyy-MM") ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>职级评定时间</strong></td>
                                                    <td>@(Model.SupplementaryInfo.RankAssessmentDate?.ToString("yyyy-MM") ?? "-")</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="layui-col-md6">
                                        <table class="layui-table">
                                            <tbody>
                                                <tr>
                                                    <td width="130"><strong>最近一次考核结果</strong></td>
                                                    <td>@(Model.SupplementaryInfo.LastAssessmentResult ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>近三年优秀次数</strong></td>
                                                    <td>@Model.SupplementaryInfo.ExcellentCount</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>个人照片</strong></td>
                                                    <td>
                                                        @if (!string.IsNullOrEmpty(Model.SupplementaryInfo.PhotoPath))
                                                        {
                                                            <img src="@Model.SupplementaryInfo.PhotoPath" alt="个人照片" style="max-width: 100px; max-height: 100px;">
                                                        }
                                                        else
                                                        {
                                                            <span>未上传</span>
                                                        }
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><strong>家庭住址</strong></td>
                                                    <td>@(Model.SupplementaryInfo.HomeAddress ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>单位地址</strong></td>
                                                    <td>@(Model.SupplementaryInfo.WorkAddress ?? "-")</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="layui-text" style="text-align: center; padding: 50px;">
                                    <i class="layui-icon layui-icon-face-surprised" style="font-size: 50px; color: #999;"></i>
                                    <p style="color: #999;">暂无补充信息</p>
                                    <a href="@Url.Action("CreateSupplementaryInfo", new { id = Model.PersonnelId })" class="layui-btn layui-btn-normal">
                                        <i class="layui-icon layui-icon-add-1"></i> 添加补充信息
                                    </a>
                                </div>
                            }
                        </div>

                        <!-- 奖惩记录 -->
                        <div class="layui-tab-item">
                            <div style="margin-bottom: 15px;">
                                <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="addRewardPunishment()">
                                    <i class="layui-icon layui-icon-add-1"></i> 添加奖惩记录
                                </button>
                            </div>
                            @if (Model.RewardPunishments.Any())
                            {
                                <table class="layui-table">
                                    <thead>
                                        <tr>
                                            <th>时间</th>
                                            <th>类型</th>
                                            <th>级别</th>
                                            <th>原因</th>
                                            <th>决定单位</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.RewardPunishments.OrderByDescending(r => r.RecordDate))
                                        {
                                            <tr>
                                                <td>@item.RecordDate.ToString("yyyy-MM-dd")</td>
                                                <td>
                                                    <span class="layui-badge @(item.Type == ComprehensiveManagementSystem.Models.RewardPunishmentType.Reward ? "layui-bg-green" : "layui-bg-red")">
                                                        @(item.Type == ComprehensiveManagementSystem.Models.RewardPunishmentType.Reward ? "奖励" : "处罚")
                                                    </span>
                                                </td>
                                                <td>@item.Level</td>
                                                <td>@item.Reason</td>
                                                <td>@item.DecisionUnit</td>
                                                <td>
                                                    <button class="layui-btn layui-btn-xs layui-btn-normal" onclick="editRewardPunishment('@item.Id')">编辑</button>
                                                    <button class="layui-btn layui-btn-xs layui-btn-danger" onclick="deleteRecord('@item.Id', 'RewardPunishment')">删除</button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }
                            else
                            {
                                <div class="layui-text" style="text-align: center; padding: 50px;">
                                    <i class="layui-icon layui-icon-face-surprised" style="font-size: 50px; color: #999;"></i>
                                    <p style="color: #999;">暂无奖惩记录</p>
                                </div>
                            }
                        </div>

                        <!-- 工作履历 -->
                        <div class="layui-tab-item">
                            <div style="margin-bottom: 15px;">
                                <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="addHistory()">
                                    <i class="layui-icon layui-icon-add-1"></i> 添加履历记录
                                </button>
                            </div>
                            @if (Model.Histories.Any())
                            {
                                <table class="layui-table">
                                    <thead>
                                        <tr>
                                            <th>开始时间</th>
                                            <th>结束时间</th>
                                            <th>工作地点</th>
                                            <th>担任角色</th>
                                            <th>工作描述</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.Histories.OrderByDescending(h => h.StartDate))
                                        {
                                            <tr>
                                                <td>@item.StartDate.ToString("yyyy-MM-dd")</td>
                                                <td>@(item.EndDate?.ToString("yyyy-MM-dd") ?? "至今")</td>
                                                <td>@item.WorkPlace</td>
                                                <td>@item.Role</td>
                                                <td>@(item.WorkDescription ?? "-")</td>
                                                <td>
                                                    <button class="layui-btn layui-btn-xs layui-btn-normal" onclick="editHistory('@item.Id')">编辑</button>
                                                    <button class="layui-btn layui-btn-xs layui-btn-danger" onclick="deleteRecord('@item.Id', 'History')">删除</button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }
                            else
                            {
                                <div class="layui-text" style="text-align: center; padding: 50px;">
                                    <i class="layui-icon layui-icon-face-surprised" style="font-size: 50px; color: #999;"></i>
                                    <p style="color: #999;">暂无履历记录</p>
                                </div>
                            }
                        </div>

                        <!-- 培训情况 -->
                        <div class="layui-tab-item">
                            <div style="margin-bottom: 15px;">
                                <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="addTraining()">
                                    <i class="layui-icon layui-icon-add-1"></i> 添加培训记录
                                </button>
                            </div>
                            @if (Model.Trainings.Any())
                            {
                                <table class="layui-table">
                                    <thead>
                                        <tr>
                                            <th>培训时间</th>
                                            <th>培训名称</th>
                                            <th>培训机构</th>
                                            <th>培训地点</th>
                                            <th>培训天数</th>
                                            <th>培训结果</th>
                                            <th>证书情况</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.Trainings.OrderByDescending(t => t.StartDate))
                                        {
                                            <tr>
                                                <td>@(item.StartDate?.ToString("yyyy-MM-dd") ?? "-") ~ @(item.EndDate?.ToString("yyyy-MM-dd") ?? "-")</td>
                                                <td>@item.TrainingName</td>
                                                <td>@item.TrainingOrganization</td>
                                                <td>@item.TrainingLocation</td>
                                                <td>@item.TrainingDays 天</td>
                                                <td>@(item.TrainingResult ?? "-")</td>
                                                <td>
                                                    @if (item.HasCertificate)
                                                    {
                                                        <span class="layui-badge layui-bg-green">已获得</span><br>
                                                        <small>@(item.CertificateName ?? "")</small>
                                                    }
                                                    else
                                                    {
                                                        <span class="layui-badge layui-bg-gray">未获得</span>
                                                    }
                                                </td>
                                                <td>
                                                    <button class="layui-btn layui-btn-xs layui-btn-normal" onclick="editTraining('@item.Id')">编辑</button>
                                                    <button class="layui-btn layui-btn-xs layui-btn-danger" onclick="deleteRecord('@item.Id', 'Training')">删除</button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }
                            else
                            {
                                <div class="layui-text" style="text-align: center; padding: 50px;">
                                    <i class="layui-icon layui-icon-face-surprised" style="font-size: 50px; color: #999;"></i>
                                    <p style="color: #999;">暂无培训记录</p>
                                </div>
                            }
                        </div>

                        <!-- 配偶信息 -->
                        <div class="layui-tab-item">
                            @if (Model.Spouse != null && !Model.Spouse.IsDeleted)
                            {
                                <div style="margin-bottom: 15px;">
                                    <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="editSpouse('@Model.Spouse.Id')">
                                        <i class="layui-icon layui-icon-edit"></i> 编辑配偶信息
                                    </button>
                                    <button class="layui-btn layui-btn-sm layui-btn-danger" onclick="deleteRecord('@Model.Spouse.Id', 'Spouse')">
                                        <i class="layui-icon layui-icon-delete"></i> 删除配偶信息
                                    </button>
                                </div>
                                <div class="layui-row layui-col-space20">
                                    <div class="layui-col-md6">
                                        <table class="layui-table">
                                            <tbody>
                                                <tr>
                                                    <td width="100"><strong>姓名</strong></td>
                                                    <td>@Model.Spouse.Name</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>籍贯</strong></td>
                                                    <td>@(Model.Spouse.NativePlace ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>出生年月</strong></td>
                                                    <td>@Model.Spouse.BirthDate.ToString("yyyy-MM-dd")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>民族</strong></td>
                                                    <td>@(Model.Spouse.Nation ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>学历</strong></td>
                                                    <td>@(Model.Spouse.Education ?? "-")</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="layui-col-md6">
                                        <table class="layui-table">
                                            <tbody>
                                                <tr>
                                                    <td width="100"><strong>工作单位</strong></td>
                                                    <td>@(Model.Spouse.WorkUnit ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>职务</strong></td>
                                                    <td>@(Model.Spouse.Position ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>联系电话</strong></td>
                                                    <td>@(Model.Spouse.Phone ?? "-")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>是否本地</strong></td>
                                                    <td>@(Model.Spouse.IsLocal ? "是" : "否")</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>住址</strong></td>
                                                    <td>@(Model.Spouse.Address ?? "-")</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="layui-text" style="text-align: center; padding: 50px;">
                                    <i class="layui-icon layui-icon-face-surprised" style="font-size: 50px; color: #999;"></i>
                                    <p style="color: #999;">暂无配偶信息</p>
                                    <button class="layui-btn layui-btn-normal" onclick="addSpouse()">
                                        <i class="layui-icon layui-icon-add-1"></i> 添加配偶信息
                                    </button>
                                </div>
                            }
                        </div>

                        <!-- 家庭成员 -->
                        <div class="layui-tab-item">
                            <div style="margin-bottom: 15px;">
                                <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="addFamilyMember()">
                                    <i class="layui-icon layui-icon-add-1"></i> 添加家庭成员
                                </button>
                            </div>
                            @if (Model.FamilyMembers.Any())
                            {
                                <table class="layui-table">
                                    <thead>
                                        <tr>
                                            <th>关系</th>
                                            <th>姓名</th>
                                            <th>性别</th>
                                            <th>出生年月</th>
                                            <th>工作单位</th>
                                            <th>联系电话</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.FamilyMembers)
                                        {
                                            <tr>
                                                <td>
                                                    @switch(item.RelationType)
                                                    {
                                                        case ComprehensiveManagementSystem.Models.FamilyRelationType.Child:
                                                            <text>子女</text>
                                                            break;
                                                        case ComprehensiveManagementSystem.Models.FamilyRelationType.Father:
                                                            <text>父亲</text>
                                                            break;
                                                        case ComprehensiveManagementSystem.Models.FamilyRelationType.Mother:
                                                            <text>母亲</text>
                                                            break;
                                                        case ComprehensiveManagementSystem.Models.FamilyRelationType.SpouseFather:
                                                            <text>配偶父亲</text>
                                                            break;
                                                        case ComprehensiveManagementSystem.Models.FamilyRelationType.SpouseMother:
                                                            <text>配偶母亲</text>
                                                            break;
                                                        case ComprehensiveManagementSystem.Models.FamilyRelationType.Other:
                                                            <text>其他</text>
                                                            break;
                                                    }
                                                </td>
                                                <td>@item.Name</td>
                                                <td>@(item.Gender == ComprehensiveManagementSystem.Models.Gender.Male ? "男" : "女")</td>
                                                <td>@item.BirthDate.ToString("yyyy-MM-dd")</td>
                                                <td>@(item.WorkUnit ?? "-")</td>
                                                <td>@(item.Phone ?? "-")</td>
                                                <td>
                                                    <button class="layui-btn layui-btn-xs layui-btn-normal" onclick="editFamilyMember('@item.Id')">编辑</button>
                                                    <button class="layui-btn layui-btn-xs layui-btn-danger" onclick="deleteRecord('@item.Id', 'FamilyMember')">删除</button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }
                            else
                            {
                                <div class="layui-text" style="text-align: center; padding: 50px;">
                                    <i class="layui-icon layui-icon-face-surprised" style="font-size: 50px; color: #999;"></i>
                                    <p style="color: #999;">暂无家庭成员信息</p>
                                </div>
                            }
                        </div>

                        <!-- 工作记录 -->
                        <div class="layui-tab-item">
                            <div style="margin-bottom: 15px;">
                                <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="addWorkRecord()">
                                    <i class="layui-icon layui-icon-add-1"></i> 添加工作记录
                                </button>
                            </div>
                            @if (Model.WorkRecords.Any())
                            {
                                <table class="layui-table">
                                    <thead>
                                        <tr>
                                            <th>工作时间</th>
                                            <th>工作地点</th>
                                            <th>工作内容</th>
                                            <th>工作类型</th>
                                            <th>工作成果</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.WorkRecords.OrderByDescending(w => w.WorkDate))
                                        {
                                            <tr>
                                                <td>@item.WorkDate.ToString("yyyy-MM-dd")</td>
                                                <td>@item.WorkPlace</td>
                                                <td>@item.WorkContent</td>
                                                <td>@(item.WorkType ?? "-")</td>
                                                <td>@(item.WorkResult ?? "-")</td>
                                                <td>
                                                    <button class="layui-btn layui-btn-xs layui-btn-normal" onclick="editWorkRecord('@item.Id')">编辑</button>
                                                    <button class="layui-btn layui-btn-xs layui-btn-danger" onclick="deleteRecord('@item.Id', 'WorkRecord')">删除</button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }
                            else
                            {
                                <div class="layui-text" style="text-align: center; padding: 50px;">
                                    <i class="layui-icon layui-icon-face-surprised" style="font-size: 50px; color: #999;"></i>
                                    <p style="color: #999;">暂无工作记录</p>
                                </div>
                            }
                        </div>

                        <!-- 活动记录 -->
                        <div class="layui-tab-item">
                            <div style="margin-bottom: 15px;">
                                <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="addActivityRecord()">
                                    <i class="layui-icon layui-icon-add-1"></i> 添加活动记录
                                </button>
                            </div>
                            @if (Model.ActivityRecords.Any())
                            {
                                <table class="layui-table">
                                    <thead>
                                        <tr>
                                            <th>开始时间</th>
                                            <th>结束时间</th>
                                            <th>活动地点</th>
                                            <th>活动名称</th>
                                            <th>参与角色</th>
                                            <th>获得成果</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.ActivityRecords.OrderByDescending(a => a.StartDate))
                                        {
                                            <tr>
                                                <td>@item.StartDate.ToString("yyyy-MM-dd")</td>
                                                <td>@(item.EndDate?.ToString("yyyy-MM-dd") ?? "-")</td>
                                                <td>@item.ActivityPlace</td>
                                                <td>@item.ActivityName</td>
                                                <td>@item.ParticipantRole</td>
                                                <td>@(item.Achievement ?? "-")</td>
                                                <td>
                                                    <button class="layui-btn layui-btn-xs layui-btn-normal" onclick="editActivityRecord('@item.Id')">编辑</button>
                                                    <button class="layui-btn layui-btn-xs layui-btn-danger" onclick="deleteRecord('@item.Id', 'ActivityRecord')">删除</button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }
                            else
                            {
                                <div class="layui-text" style="text-align: center; padding: 50px;">
                                    <i class="layui-icon layui-icon-face-surprised" style="font-size: 50px; color: #999;"></i>
                                    <p style="color: #999;">暂无活动记录</p>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        layui.use(['element', 'layer'], function(){
            var element = layui.element;
            var layer = layui.layer;
            
            // 延迟执行，确保DOM完全加载
            setTimeout(function() {
                // 处理tab参数，切换到指定的标签页
                var urlParams = new URLSearchParams(window.location.search);
                var tabIndex = urlParams.get('tab');
                console.log('当前URL参数 tab:', tabIndex);
                
                if (tabIndex !== null && tabIndex !== '') {
                    var tabNumber = parseInt(tabIndex);
                    console.log('解析的tab索引:', tabNumber);
                    
                    if (tabNumber >= 0 && tabNumber <= 8) {
                        console.log('切换到tab:', tabNumber);
                        
                        // 直接操作DOM元素来切换tab
                        var tabTitles = document.querySelectorAll('.layui-tab-title li');
                        var tabContents = document.querySelectorAll('.layui-tab-item');
                        
                        // 移除所有活动状态
                        tabTitles.forEach(function(title) {
                            title.classList.remove('layui-this');
                        });
                        tabContents.forEach(function(content) {
                            content.classList.remove('layui-show');
                        });
                        
                        // 激活指定tab
                        if (tabTitles[tabNumber]) {
                            tabTitles[tabNumber].classList.add('layui-this');
                        }
                        if (tabContents[tabNumber]) {
                            tabContents[tabNumber].classList.add('layui-show');
                        }
                        
                        console.log('已切换到tab索引:', tabNumber);
                    } else {
                        console.log('tab索引超出范围');
                    }
                } else {
                    console.log('没有找到tab参数');
                }
            }, 200);
            
            // 奖惩记录管理
            window.addRewardPunishment = function() {
                location.href = '@Url.Action("CreateRewardPunishment", new { id = Model.PersonnelId })';
            };
            
            window.editRewardPunishment = function(id) {
                location.href = '@Url.Action("EditRewardPunishment", new { id = "__ID__" })'.replace('__ID__', id);
            };
            
            // 工作履历管理
            window.addHistory = function() {
                location.href = '@Url.Action("CreateHistory", new { id = Model.PersonnelId })';
            };
            
            window.editHistory = function(id) {
                location.href = '@Url.Action("EditHistory", new { id = "__ID__" })'.replace('__ID__', id);
            };
            
            // 工作记录管理
            window.addWorkRecord = function() {
                location.href = '@Url.Action("CreateWorkRecord", new { id = Model.PersonnelId })';
            };
            
            window.editWorkRecord = function(id) {
                location.href = '@Url.Action("EditWorkRecord", new { id = "__ID__" })'.replace('__ID__', id);
            };
            
            // 活动记录管理
            window.addActivityRecord = function() {
                location.href = '@Url.Action("CreateActivityRecord", new { id = Model.PersonnelId })';
            };
            
            window.editActivityRecord = function(id) {
                location.href = '@Url.Action("EditActivityRecord", new { id = "__ID__" })'.replace('__ID__', id);
            };
            
            // 配偶信息管理
            window.addSpouse = function() {
                location.href = '@Url.Action("CreateSpouse", new { id = Model.PersonnelId })';
            };
            
            window.editSpouse = function(id) {
                location.href = '@Url.Action("EditSpouse", new { id = "__ID__" })'.replace('__ID__', id);
            };
            
            // 家庭成员管理
            window.addFamilyMember = function() {
                location.href = '@Url.Action("CreateFamilyMember", new { id = Model.PersonnelId })';
            };
            
            window.editFamilyMember = function(id) {
                location.href = '@Url.Action("EditFamilyMember", new { id = "__ID__" })'.replace('__ID__', id);
            };
            
            // 添加培训记录
            window.addTraining = function() {
                location.href = '@Url.Action("CreateTraining", new { id = Model.PersonnelId })';
            };
            
            // 编辑培训记录
            window.editTraining = function(id) {
                location.href = '@Url.Action("EditTraining", new { id = "__ID__" })'.replace('__ID__', id);
            };
            
            window.deleteRecord = function(id, type) {
                layer.confirm('确定要删除这条记录吗？', {icon: 3, title:'提示'}, function(index){
                    var form = document.createElement('form');
                    form.method = 'POST';
                    
                    var tokenInput = document.createElement('input');
                    tokenInput.type = 'hidden';
                    tokenInput.name = '__RequestVerificationToken';
                    tokenInput.value = '@Html.AntiForgeryToken()'.match(/value="([^"]+)"/)[1];
                    
                    var idInput = document.createElement('input');
                    idInput.type = 'hidden';
                    idInput.name = 'id';
                    idInput.value = id;
                    
                    form.appendChild(tokenInput);
                    form.appendChild(idInput);
                    
                    if (type === 'Training') {
                        form.action = '@Url.Action("DeleteTraining")';
                    } else if (type === 'RewardPunishment') {
                        form.action = '@Url.Action("DeleteRewardPunishment")';
                    } else if (type === 'History') {
                        form.action = '@Url.Action("DeleteHistory")';
                    } else if (type === 'WorkRecord') {
                        form.action = '@Url.Action("DeleteWorkRecord")';
                    } else if (type === 'ActivityRecord') {
                        form.action = '@Url.Action("DeleteActivityRecord")';
                    } else if (type === 'Spouse') {
                        form.action = '@Url.Action("DeleteSpouse")';
                    } else if (type === 'FamilyMember') {
                        form.action = '@Url.Action("DeleteFamilyMember")';
                    } else {
                        layer.msg('删除功能开发中...', {icon: 6});
                        layer.close(index);
                        return;
                    }
                    
                    document.body.appendChild(form);
                    form.submit();
                    layer.close(index);
                });
            };
        });
    </script>
}